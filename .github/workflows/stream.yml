name: Bot Live Streaming Otomatis

on:
  workflow_dispatch:
  schedule:
    - cron: "30 20 3 1 *"
    - cron: "30 20 4 1 *"

jobs:
  live-acak-otomatis:
    runs-on: ubuntu-latest
    timeout-minutes: 180 # 3 JAM NONSTOP

    steps:
      - name: 1. Siapkan Mesin
        uses: actions/checkout@v3

      - name: 2. Install FFmpeg
        run: |
          sudo apt-get update
          sudo apt-get install -y ffmpeg

      - name: 3. Download Koleksi Video
        run: |
          # ========================================================
          # MASUKKAN SEMUA LINK VIDEO ANDA DI BAWAH INI
          # (Minimal 2 video supaya bisa diacak)
          # ========================================================

          wget -O vid1.mp4 "https://github.com/iniadhen-coder/live/releases/download/v1.0/WRONG.EYES.Marvel.Avengers.NEW.EPISODES.Puzzle.Wrong.Heads.mp4"
          wget -O vid2.mp4 "https://github.com/iniadhen-coder/live/releases/download/v1.0/WRONG.EYES.New.Episodes.-.Assasino.Ballerina.Cappucino.x.KPop.Demon.Hunters.Puzzle.Wrong.Heads.mp4"
          wget -O vid3.mp4 "https://github.com/iniadhen-coder/live/releases/download/v1.0/WRONG.EYES.New.Episodes.-.Gabby.s.Dollhouse.Puzzle.Wrong.Heads.Cute.Wrong.EYE.mp4"
          wget -O vid4.mp4 "https://github.com/iniadhen-coder/live/releases/download/v1.0/WRONG.EYES.New.Episodes.-.PAW.PATROL.Puzzle.Wrong.Heads.mp4"
          wget -O vid5.mp4 "https://github.com/iniadhen-coder/live/releases/download/v1.0/WRONG.EYES.New.Episodes.-.Peppa.Pig.x.Elsa.x.Sheriff.Labrador.Puzzle.Wrong.Heads.Cute.Wrong.mp4"
          wget -O vid6.mp4 "https://github.com/iniadhen-coder/live/releases/download/v1.0/WRONG.EYES.New.Episodes.-.TUNG.TUNG.SAHUR.x.RAGATHA.Puzzle.Wrong.Heads.Cute.Wrong.EYE.mp4"
          wget -O vid7.mp4 "https://github.com/iniadhen-coder/live/releases/download/v1.0/WRONG.EYES.New.Episodes.BabyBoss.x.Paw.Patrol.x.Baby.Shark.Wrong.Heads.Cute.Wrong.EYE.mp4"
          wget -O vid8.mp4 "https://github.com/iniadhen-coder/live/releases/download/v1.0/WRONG.EYES.Super.Mario.Franchise.NEW.EPISODES.Puzzle.Wrong.Heads.mp4"

          # Mau tambah lagi? Tinggal copy baris wget di atas:
          # wget -O vid4.mp4 "LINK_VIDEO_4"

      - name: 4. Kocok Urutan (SHUFFLE)
        run: |
          echo "[INFO] Mengocok urutan video..."

          # Mengacak semua file .mp4 yang berhasil didownload
          ls *.mp4 | shuf > urutan_acak.txt

          # Membuat playlist yang bisa dibaca FFmpeg
          for f in $(cat urutan_acak.txt); do echo "file '$PWD/$f'" >> playlist.txt; done

          echo "=== URUTAN TAYANG HARI INI ==="
          cat playlist.txt

      - name: 5. Mulai Streaming
        env:
          KUNCI: ${{ secrets.STREAM_KEY }}
        run: |
          # Memutar video berdasarkan playlist.txt
          ffmpeg -re -f concat -safe 0 -stream_loop -1 -i playlist.txt -c:v libx264 -preset veryfast -maxrate 3000k -bufsize 6000k -pix_fmt yuv420p -g 50 -c:a aac -b:a 128k -ar 44100 -f flv "rtmp://a.rtmp.youtube.com/live2/$KUNCI"
